
@model FirstWebApplication1.Models.ObstacleData

@{
    ViewData["Title"] = "Obstacle Details";
}

<body class="bg-cover bg-center" style="background-image: url('/images/BackgroundImageGreen.png');">
    <section class="mx-auto max-w-6xl mt-8">
        <div class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-8">
            <div class="grid grid-cols-1 gap-6">
                <div>
                    <h1 class="text-2xl font-semibold text-gray-900">@Model.ObstacleName</h1>
                    <p class="text-sm text-gray-600">@Model.ObstacleDescription</p>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Status</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            @{
                                string statusClass = Model.Status switch
                                {
                                    "Approved" => "bg-green-100 text-green-800",
                                    "Declined" => "bg-red-100 text-red-800",
                                    "Pending" => "bg-yellow-100 text-yellow-800",
                                    _ => "bg-yellow-100 text-yellow-800"
                                };
                            }
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium @statusClass">
                                @Model.Status
                            </span>
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Submitted By</dt>
                        <dd class="mt-1 text-sm text-gray-900">@Model.SubmittedBy</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Submitted Date</dt>
                        <dd class="mt-1 text-sm text-gray-900">@Model.SubmittedDate.ToString("MMM dd, yyyy HH:mm")</dd>
                    </div>
                </div>

                @* Approval/Moderation actions: visible to Registerfører and Admin *@
                @if (User.IsInRole("Registerfører") || User.IsInRole("Admin"))
                {
                    <div class="border-t pt-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Approval Actions</h3>

                        <div class="flex space-x-3">
                            <form asp-action="Approve" asp-route-id="@Model.Id" method="post" class="inline">
                                @Html.AntiForgeryToken()
                                <button type="submit"
                                        class="inline-flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    Approve
                                </button>
                            </form>

                            <form asp-action="Decline" asp-route-id="@Model.Id" method="post" class="inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="declineReason" value="" />
                                <button type="submit"
                                        class="inline-flex items-center rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                    Reject
                                </button>
                            </form>

                            <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="inline" onsubmit="return confirm('Permanently delete this report?');">
                                @Html.AntiForgeryToken()
                                <button type="submit"
                                        class="inline-flex items-center rounded-lg bg-gray-600 px-4 py-2 text-sm font-medium text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                    Delete
                                </button>
                            </form>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
</body>

@section Scripts {
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([@Model.Latitude, @Model.Longitude], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        L.marker([@Model.Latitude, @Model.Longitude])
            .addTo(map)
            .bindPopup('@Model.ObstacleName')
            .openPopup();
    </script>
}