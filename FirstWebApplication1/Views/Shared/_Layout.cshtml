@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager

@{
    var isPilot = User.IsInRole("Pilot");
    var navButtonBase = "text-gray-900 hover:bg-gray-50 hover:text-gray-900 rounded-md";
    var navButtonClass = isPilot
        ? $"{navButtonBase} px-4 py-3 text-base font-semibold"
        : $"{navButtonBase} px-3 py-2 text-sm font-medium";
    var authButtonClass = isPilot
        ? "text-gray-700 hover:text-gray-900 px-4 py-3 rounded-md text-base font-semibold"
        : "text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-t-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - NRL Registration System</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Optional: Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    @await RenderSectionAsync("Head", required: false)
</head>
<body class="min-h-screen bg-gray-50">
    @inject SignInManager<IdentityUser> SignInManager
    @inject UserManager<IdentityUser> UserManager

    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a asp-controller="Home" asp-action="Index" class="flex-shrink-0 flex items-center">
                        <img class="h-8 w-auto" src="~/images/standard_kartverket.png" alt="Kartverket Logo">
                        <span class="ml-2 text-lg font-semibold text-gray-900">NRL System</span>
                    </a>

                    @if (SignInManager.IsSignedIn(User))
                    {
                        <div class="hidden md:ml-6 md:flex md:space-x-4">
                            <a asp-controller="Obstacle" asp-action="List"
                               class="@navButtonClass">
                                View Obstacles
                            </a>
                            <a asp-controller="Obstacle" asp-action="SelectType"
                               class="@navButtonClass">
                                Report Obstacle
                            </a>

                            @if (User.IsInRole("Pilot"))
                            {
                                <a asp-controller="Pilot" asp-action="Map"
                                   class="@navButtonClass">
                                    Pilot Map
                                </a>
                            }

                            @if (User.IsInRole("Admin"))
                            {
                                <a asp-controller="Admin" asp-action="Users"
                                   class="text-gray-900 hover:bg-gray-50 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium">
                                    Manage Users
                                </a>
                            }
                        </div>
                    }
                </div>

                <div class="flex items-center">
                    @if (SignInManager.IsSignedIn(User))
                    {
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-700">Hello, @User.Identity?.Name!</span>

                            @if (User.IsInRole("Admin"))
                            {
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">Admin</span>
                            }
                            else if (User.IsInRole("Caseworker"))
                            {
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Caseworker</span>
                            }
                            else if (User.IsInRole("Pilot"))
                            {
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Pilot</span>
                            }

                            <form asp-controller="Account" asp-action="Logout" method="post" class="inline">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium">
                                    Logout
                                </button>
                            </form>
                        </div>
                    }
                    else
                    {
                        <div class="flex space-x-4">
                            <a asp-controller="Account" asp-action="Login" class="@authButtonClass">Login</a>
                            <a asp-controller="Account" asp-action="Register" class="@authButtonClass">Register</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </nav>

    <main>
        @RenderBody()
    </main>


    @if (TempData["NotificationMessage"] is string notificationMessage)
    {
        var notificationType = TempData["NotificationType"] as string ?? "info";
        var backgroundClass = notificationType switch
        {
            "success" => "bg-green-600 text-white",
            "error" => "bg-red-600 text-white",
            _ => "bg-gray-800 text-white"
        };

        <div id="notification-toast"
             class="fixed bottom-6 right-6 px-4 py-3 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 @backgroundClass"
             role="status"
             aria-live="polite">
            @notificationMessage
        </div>
    }



    <!-- jQuery (needed for some validation) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        window.addEventListener('load', () => {
            const toast = document.getElementById('notification-toast');

            if (!toast) {
                return;
            }

            requestAnimationFrame(() => {
                toast.classList.remove('opacity-0');
            });

            setTimeout(() => {
                toast.classList.add('opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3500);
        });
    </script>

    <!-- Validation Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>